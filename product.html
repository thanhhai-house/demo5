<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>S·∫£n ph·∫©m</title>
  <style>
    :root{--panel:rgba(255,255,255,.035);--line:rgba(255,255,255,.10);--text:#eaf0ff;--muted:#9bb0d0;--accent:#4da3ff;--radius:18px;--shadow:0 12px 30px rgba(0,0,0,.35);}
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);
      background:linear-gradient(180deg,#050812,#0b1220 50%,#050812);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1220px;margin:0 auto;padding:18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      padding:14px 16px;background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
    .brand{display:flex;gap:10px;align-items:center;font-weight:900}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 0 18px rgba(77,163,255,.55)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);cursor:pointer}
    .btn.primary{border-color:rgba(77,163,255,.45);background:rgba(77,163,255,.12)}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px}
    .panel{margin-top:16px;border:1px solid var(--line);border-radius:var(--radius);background:var(--panel);overflow:hidden;box-shadow:var(--shadow)}
    .panelHead{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .panelBody{padding:14px}
    .split{display:grid;grid-template-columns:1.05fr .95fr;gap:14px}
    .card{border:1px solid var(--line);border-radius:var(--radius);background:var(--panel);overflow:hidden}
    .hero{aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;background:#0a1020;border-bottom:1px solid var(--line)}
    .hero img{max-width:100%;max-height:100%;object-fit:contain}
    .thumbs{display:flex;gap:10px;flex-wrap:wrap;padding:12px}
    .thumb{width:72px;height:72px;border-radius:14px;border:1px solid var(--line);background:#0a1020;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .thumb img{max-width:92%;max-height:92%;object-fit:contain}
    .tabs{display:flex;gap:10px;border-bottom:1px solid var(--line);padding:0 14px;margin-top:10px}
    .tab{padding:12px 8px;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent}
    .tab.active{color:var(--text);border-bottom-color:var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:10px}
    .mini{border:1px solid var(--line);border-radius:16px;background:rgba(255,255,255,.03);overflow:hidden}
    .img{aspect-ratio:4/3;background:#0a1020;display:flex;align-items:center;justify-content:center}
    .img img{max-width:100%;max-height:100%;object-fit:contain}
    .pad{padding:12px}
    .name{font-weight:800}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    td{padding:10px 8px;border-bottom:1px solid var(--line);color:var(--muted)}
    td:first-child{color:var(--text);width:45%}
    @media(max-width:820px){.split{grid-template-columns:1fr}.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:520px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand"><div class="dot"></div><span id="siteName">CATALOG</span> <span class="pill">PRODUCT</span></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn" id="contactBtn" href="#" target="_blank">üí¨ Li√™n h·ªá</a>
      <button class="btn" id="copyBtn">üîó Copy link</button>
      <a class="btn primary" href="./index.html">‚¨Ö Home</a>
    </div>
  </div>

  <div class="panel">
    <div class="panelHead">
      <span class="pill" id="crumb">Trang ch·ªß / ...</span>
      <span class="pill" id="statusPill">active</span>
    </div>
    <div class="panelBody">
      <div class="split">
        <div class="card">
          <div class="hero" id="hero"></div>
          <div class="thumbs" id="thumbs"></div>
        </div>

        <div class="card">
          <div class="pad">
            <h2 id="pName" style="margin:0 0 6px"></h2>
            <div class="muted" id="pMeta"></div>
            <p class="muted" id="pShort"></p>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
              <span class="pill" id="pPrice"></span>
              <span class="pill" id="pStock"></span>
              <span class="pill" id="pUpdated"></span>
            </div>

            <div class="tabs">
              <div class="tab active" data-tab="desc">M√¥ t·∫£</div>
              <div class="tab" data-tab="spec">Th√¥ng s·ªë</div>
              <div class="tab" data-tab="rel">Li√™n quan</div>
            </div>

            <div id="tab_desc" style="padding:12px 14px"></div>
            <div id="tab_spec" style="padding:12px 14px;display:none"></div>
            <div id="tab_rel" style="padding:12px 14px;display:none">
              <div class="grid" id="relGrid"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
const API_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE";
const $ = (id)=>document.getElementById(id);
const qs = new URLSearchParams(location.search);
const slug = qs.get("slug") || "";

const state = { site:{site_name:"CATALOG",contact_url:"#",currency:"VND"}, product:null };

function fmtMoney(v){
  v = Number(v||0);
  if(state.site.currency==="VND") return v.toLocaleString("vi-VN")+" ‚Ç´";
  return v.toLocaleString()+" "+(state.site.currency||"");
}
async function apiGet(params){
  const url = API_URL + "?" + new URLSearchParams(params).toString();
  const res = await fetch(url);
  return await res.json();
}
function setHero(src){
  $("hero").innerHTML = src ? `<img src="${src}" alt="">` : `<div class="muted">Kh√¥ng c√≥ ·∫£nh</div>`;
}

async function bootstrapSite(){
  const s = await apiGet({action:"site"});
  if(s.ok) state.site = s.site;
  $("siteName").textContent = state.site.site_name || "CATALOG";
  $("contactBtn").href = state.site.contact_url || "#";
}
function miniCard(p){
  const href = "./product.html?slug=" + encodeURIComponent(p.slug);
  return `
    <a class="mini" href="${href}">
      <div class="img">${p.image?`<img src="${p.image}" alt="">`:""}</div>
      <div class="pad">
        <div class="name">${String(p.name||"")}</div>
        <div class="muted" style="font-size:12px;margin-top:6px">${String(p.sku||"")}</div>
      </div>
    </a>`;
}

async function loadRelated(p){
  const params = p.category ? {action:"list", category:p.category, page:1, limit:30, sort:"updated_desc"} : {action:"list", page:1, limit:30, sort:"updated_desc"};
  const d = await apiGet(params);
  if(!d.ok) return;
  let rel = (d.items||[]).filter(x=>x.slug!==p.slug);
  const sameBrand = rel.filter(x=>(x.brand||"")===(p.brand||""));
  rel = [...sameBrand, ...rel.filter(x=>(x.brand||"")!==(p.brand||""))].slice(0,8);
  $("relGrid").innerHTML = rel.map(miniCard).join("");
}

async function loadProduct(){
  if(!slug){ $("pName").textContent = "Thi·∫øu slug"; return; }
  const d = await apiGet({action:"get", slug});
  if(!d.ok){ $("pName").textContent = "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"; return; }
  const p = d.product;
  state.product = p;

  document.title = (p.name||p.sku||"S·∫£n ph·∫©m") + " | " + (state.site.site_name||"CATALOG");
  $("crumb").textContent = `Trang ch·ªß / ${p.category||"S·∫£n ph·∫©m"} / ${p.name||""}`;
  $("statusPill").textContent = (p.status||"active")==="hidden" ? "hidden" : "active";

  $("pName").textContent = p.name||"";
  $("pMeta").textContent = `SKU: ${p.sku||""} ‚Ä¢ Brand: ${p.brand||""} ‚Ä¢ Category: ${p.category||""}`;
  $("pShort").textContent = p.short_desc||"";
  $("pPrice").textContent = "Gi√°: " + fmtMoney(p.price||0);
  $("pStock").textContent = "T·ªìn: " + Number(p.stock||0);
  $("pUpdated").textContent = "C·∫≠p nh·∫≠t: " + (p.updated_at||"-");

  const imgs = p.images||[];
  setHero(imgs[0]);
  $("thumbs").innerHTML = imgs.map(u=>`
    <div class="thumb" data-u="${u}"><img src="${u}" alt=""></div>
  `).join("");
  document.querySelectorAll(".thumb").forEach(el=>{
    el.addEventListener("click", ()=> setHero(el.getAttribute("data-u")));
  });

  $("tab_desc").innerHTML = p.desc_html || `<p class="muted">Ch∆∞a c√≥ m√¥ t·∫£.</p>`;

  const specs = p.specs || {};
  const keys = Object.keys(specs||{});
  $("tab_spec").innerHTML = keys.length
    ? `<table>${keys.map(k=>`<tr><td>${k}</td><td>${specs[k]}</td></tr>`).join("")}</table>`
    : `<p class="muted">Ch∆∞a c√≥ th√¥ng s·ªë.</p>`;

  await loadRelated(p);
}

$("copyBtn").addEventListener("click", async ()=>{
  await navigator.clipboard.writeText(location.href);
  alert("ƒê√£ copy link!");
});

document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const k=t.dataset.tab;
    $("tab_desc").style.display = (k==="desc")?"block":"none";
    $("tab_spec").style.display = (k==="spec")?"block":"none";
    $("tab_rel").style.display = (k==="rel")?"block":"none";
  });
});

(async function(){
  if(!API_URL.includes("script.google.com")) alert("B·∫°n ch∆∞a d√°n API_URL");
  await bootstrapSite();
  await loadProduct();
})();
</script>
</body>
</html>
