<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Catalog</title>
  <style>
    :root{--bg1:#eaf3ff;--bg2:#ffffff;--card:#ffffff;--text:#0b1b3a;--muted:#5a6b8a;--line:rgba(12,45,110,.12);--primary:#1e63ff;--shadow:0 18px 50px rgba(10,46,115,.10);}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:linear-gradient(180deg,var(--bg1),var(--bg2));min-height:100vh;display:flex;flex-direction:column;}
    .container{max-width:1100px;margin:24px auto;padding:0 16px;width:100%}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .badge{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:4px 10px;border-radius:999px;background:rgba(30,99,255,.06)}
    .nav{display:flex;gap:10px;flex-wrap:wrap}
    .nav a{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.8);text-decoration:none;color:var(--text)}
    .nav a.active{border-color:rgba(30,99,255,.35);background:rgba(30,99,255,.08)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:var(--shadow)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
    input,button{border-radius:12px;border:1px solid var(--line);padding:10px 12px;background:rgba(255,255,255,.9);color:var(--text);outline:none}
    input{flex:1;min-width:220px}
    button{cursor:pointer}
    button.primary{background:linear-gradient(180deg,#1e63ff,#0b4fe6);color:#fff;border-color:rgba(30,99,255,.35)}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:14px;overflow:hidden}
    th,td{padding:12px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
    th{background:rgba(30,99,255,.05)}
    tr:hover td{background:rgba(30,99,255,.04);cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    footer{margin-top:auto;border-top:1px solid rgba(12,45,110,.10);background:rgba(255,255,255,.7)}
    .footerInner{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    a{color:var(--primary)}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">ðŸ“˜ <span id="siteName">CATALOG</span> <span class="badge" id="currencyBadge">VND</span></div>
      <div class="nav">
        <a class="active" href="index.html">Danh sÃ¡ch</a>
        <a href="admin.html">Quáº£n lÃ½</a>
      </div>
    </div>

    <div class="card">
      <div class="toolbar">
        <input id="q" placeholder="TÃ¬m: tÃªn / OEM / thay tháº¿ / loáº¡i / thÆ°Æ¡ng hiá»‡u..." />
        <button onclick="loadAll()">Táº£i láº¡i</button>
        <button class="primary" onclick="location.href='admin.html'">+ Quáº£n lÃ½</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>ID</th><th>TÃªn sáº£n pháº©m</th><th>MÃ£ OEM</th><th>ThÆ°Æ¡ng hiá»‡u</th><th>GiÃ¡ nháº­p</th><th>Sá»‘ lÆ°á»£ng</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="muted" id="status" style="margin-top:10px"></div>
      <div class="muted" id="contact" style="margin-top:6px"></div>
    </div>
  </div>

  <footer>
    <div class="footerInner">
      <div>Â© <span id="yy"></span> <span id="siteName2">CATALOG</span> â€¢ All rights reserved.</div>
      <div>Made with Google Sheets + Apps Script</div>
    </div>
  </footer>

<script>
  const SCRIPT_URL = "PASTE_YOUR_WEB_APP_URL_HERE";

  function $(id){return document.getElementById(id);}
  function esc(x){return String(x??"").replace(/[&<>"']/g,s=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[s]));}
  function fmtMoney(n){ n=Number(n||0); return Number.isFinite(n)? n.toLocaleString("vi-VN"):"0"; }

  let settings = {};
  let products = [];

  async function apiGet(params){
    const url = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    const r = await fetch(url);
    return r.json();
  }

  async function loadSettings(){
    const res = await apiGet({action:"settings"});
    settings = res.ok ? (res.settings||{}) : {};
    const site = settings.SITE_NAME || "CATALOG";
    const cur = settings.CURRENCY || "VND";
    $("siteName").textContent = site;
    $("siteName2").textContent = site;
    $("currencyBadge").textContent = cur;

    if (settings.CONTACT_URL){
      $("contact").innerHTML = `LiÃªn há»‡: <a target="_blank" href="${esc(settings.CONTACT_URL)}">${esc(settings.CONTACT_URL)}</a>`;
    } else $("contact").textContent = "";
  }

  async function loadProducts(){
    $("status").textContent = "Äang táº£i...";
    const res = await apiGet({action:"list"});
    products = res.ok ? (res.items||[]) : [];
    $("status").textContent = res.ok ? `CÃ³ ${products.length} sáº£n pháº©m.` : (res.error||"Lá»—i táº£i dá»¯ liá»‡u");
    render();
  }

  function render(){
    const q = $("q").value.trim().toLowerCase();
    const rows = products.filter(p=>{
      const s = `${p.id||""} ${p.ten_san_pham||""} ${p.ma_oem||""} ${p.ma_thay_the||""} ${p.loai||""} ${p.thuong_hieu||""}`.toLowerCase();
      return !q || s.includes(q);
    });

    $("tbody").innerHTML = rows.map(p=>`
      <tr onclick="location.href='product.html?id=${encodeURIComponent(p.id)}'">
        <td>${esc(p.id)}</td>
        <td>${esc(p.ten_san_pham)}</td>
        <td>${esc(p.ma_oem)}</td>
        <td>${esc(p.thuong_hieu)}</td>
        <td>${fmtMoney(p.gia)} ${esc(settings.CURRENCY||"VND")}</td>
        <td>${esc(p.so_luong)}</td>
      </tr>
    `).join("");
  }

  $("q").addEventListener("input", render);

  async function loadAll(){
    await loadSettings();
    await loadProducts();
  }

  $("yy").textContent = new Date().getFullYear();
  loadAll();
</script>
</body>
</html>
